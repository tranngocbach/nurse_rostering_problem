<!-- # Solving Nurse Rostering Problem from INRC-II by MaxSAT Encoding Approach

## Overview

This project addresses the Nurse Rostering Problem as defined in the Second International Nurse Rostering Competition (INRC-II). For more details, visit the [INRC-II official website](https://mobiz.vives.be/inrc2/).

## File Structure

### Main Source Files

- `main_ubu.py`: Ubuntu-specific version of the main script.
- `global_nurse_rostering_sat.py`: Encodes MaxSAT for all hard and soft constraints.
- `extract_to_xlsx.py`: Utility for exporting results to Excel files.

### Experimental Results Folder

- `statistic/`: Contains experimental results and comparison charts for variables and clauses across configurations.

### Solver Used

- `TT-Open-WBO-INC` (IntelSATSolver-based): Used to solve MaxSAT-encoded formulas.

## How to Run

1. **Install Dependencies**:
   ```bash
   pip install -r requirements.txt
   ```

2. **Download Input Dataset**:
   - Download the input JSON files from the [official INRC-II website](https://mobiz.vives.be/inrc2/?page_id=20).
   - Place the files in the `input` folder in the root directory.

3. **Add the Solver `TT-Open-WBO-INC`**:
   - Clone the repository from [GitHub](https://github.com/alexander-nadel-academic/tt-open-wbo-inc).
   - Build dd the solver to the root directory of the source code.

4. **Run the Main Script**:
   - There are two ways to execute the script:

   **Option 1**: Run the Ubuntu-specific script:
   ```bash
   python3 main_ubu.py
   ```

   **Option 2**: Manually specify command-line parameters:
   ```bash
   python3 global_nurse_rostering_sat.py --sce <scenario_file> --his <history_file> --weeks <week_files> --sol <solution_folder> --timeout <timeout_in_seconds>
   ```

   **Example Usage**:
   ```bash
   python3 global_nurse_rostering_sat.py \
       --sce ./input/scenario.json \
       --his ./input/history.json \
       --weeks ./input/week1.json ./input/week2.json \
       --sol ./solution/output_folder \
       --timeout 300
   ```

   **Command-Line Options**:
   ```
   usage: global_nurse_rostering_sat.py [-h] --sce SCE --his HIS --weeks WEEKS [WEEKS ...] --sol SOL [--timeout TIMEOUT]

   Nurse Rostering Problem Solver

   options:
     -h, --help            Show this help message and exit
     --sce SCE             Scenario file
     --his HIS             Initial history file
     --weeks WEEKS [WEEKS ...]
                           Week data files
     --sol SOL             Solution folder
     --timeout TIMEOUT     Timeout in seconds
   ``` -->

   # Solving the Nurse Rostering Problem (INRC-II) using a MaxSAT Encoding Approach

## Overview

This project implements a MaxSAT-based approach to solve the static version of Nurse Rostering Problem (NRP) as defined by the Second International Nurse Rostering Competition (INRC-II). The official competition details can be found on the [INRC-II website](https://mobiz.vives.be/inrc2/). Our method focuses on encoding the problem constraints into a Weighted Conjunctive Normal Form (WCNF) and utilizing a MaxSAT solver to find optimal or near-optimal solutions.

## File Structure

The project is organized as follows:

*   **Source Code Files:**
    *   `main_ubu.py`: The main script for executing the solver, potentially with configurations specific to an Ubuntu environment.
    *   `global_nurse_rostering_sat.py`: Contains the core logic for encoding all hard and soft constraints of the NRP into a MaxSAT formula.
    *   `extract_to_xlsx.py`: A utility script for exporting the generated rosters and experimental results into Excel (xlsx) files for analysis.

*   **Experimental Results Directory:**
    *   `statistic/`: This directory stores files related to the experimental results, including generated charts comparing the number of variables and clauses across different encoding configurations.

*   **MaxSAT Solver:**
    *   `TT-Open-WBO-Inc` (IntelSATSolver-based): This state-of-the-art MaxSAT solver is used to find solutions for the WCNF formulas generated by our encoding.

## How to Run

### 1. Prerequisites

*   **Python 3:** Ensure Python 3 is installed on your system.
*   **Java Runtime Environment (JRE):** Required to run the INRC-II `validator.jar`.
*   **Dependencies:** Install the required Python libraries by running:
    ```bash
    pip install -r requirements.txt
    ```
*   **TT-Open-WBO-Inc Solver:**
    1.  Clone the solver from its official repository:
        ```bash
        git clone https://github.com/alexander-nadel-academic/tt-open-wbo-inc.git
        ```
    2.  Compile the solver according to the instructions in its repository. Typically, you would use the `IntelSATSolver` backend.
    3.  Place the compiled executable (e.g., `tt-open-wbo-inc-IntelSATSolver_static`) in the root directory of this project or ensure it's accessible via your system's PATH.
*   **INRC-II Validator Tool:**
    1.  Download `validator.jar` from the "Tools" section of the [INRC-II official website](https://mobiz.vives.be/inrc2/).
    2.  Place `validator.jar` in the root directory of this project or a known location.

### 2. Input Data

*   Download the INRC-II instance datasets (preferably in JSON format for compatibility with this project) from the [official INRC-II download page](https://mobiz.vives.be/inrc2/?page_id=20).
*   Create an `input/` directory in the root of the project.
*   Place the downloaded instance files (which typically include a scenario file, an initial history file, and multiple week data files for each instance) into the `input/` directory. Structure them appropriately, for example, in subdirectories named after each instance.

### 3. Executing the Solver

There are two primary ways to run the solver:

*   **Option 1: Using the main script (Recommended for INRC-II evaluation)**
    This script likely handles the multi-stage solving process as required by INRC-II, calling `global_nurse_rostering_sat.py` for each week.
    ```bash
    python3 main_ubuntu.py
    ```
    *(Note: You might need to configure `main_ubuntu.py` to point to the correct instance files or solver path if it's not automatically detected.)*

*   **Option 2: Directly calling `global_nurse_rostering_sat.py` (For single-stage solving or testing)**
    You can call the core encoding script directly with command-line arguments if you wish to solve a single stage or test specific configurations.
    ```bash
    usage: python3 global_nurse_rostering_sat.py [-h] --sce SCE_FILE --his HISTORY_FILE --weeks WEEK_DATA_FILE [WEEK_DATA_FILE ...] --sol OUTPUT_SOLUTION_FOLDER [--timeout TIMEOUT_SECONDS]

    Nurse Rostering Problem Solver (MaxSAT-based)

    options:
      -h, --help            show this help message and exit
      --sce SCE_FILE        Path to the Scenario File (e.g., input/n030w4/Sc-n030w4.json)
      --his HISTORY_FILE    Path to the Initial History File (e.g., input/n030w4/H0-n030w4-0.json)
      --weeks WEEK_DATA_FILE [WEEK_DATA_FILE ...]
                            Path(s) to the Week Data File(s) (e.g., input/n030w4/WD-n030w4-0.json)
      --sol OUTPUT_SOLUTION_FOLDER
                            Path to the folder where solution files will be saved
      --timeout TIMEOUT_SECONDS
                            Timeout in seconds for the MaxSAT solver for this stage
    ```
    **Example usage for a single stage:**
    ```bash
    python3 global_nurse_rostering_sat.py \
        --sce input/n030w4_0_1-2-3-4/Sc-n030w4_0_1-2-3-4.json \
        --his input/n030w4_0_1-2-3-4/H0-n030w4_0_1-2-3-4-0.json \
        --weeks input/n030w4_0_1-2-3-4/WD-n030w4_0_1-2-3-4-0.json \
        --sol output_solutions/n030w4_0_1-2-3-4/ \
        --timeout 120
    ```

---

*Make sure to adapt paths and specific commands if your project structure or the scripts' behavior differs slightly.*